// Generated by CoffeeScript 1.6.3
(function() {
  var CUSTOMERS, app, assert, base_url, express, freeport, slumber;

  assert = require('assert');

  express = require('express');

  freeport = require('freeport');

  slumber = require('..');

  base_url = 'http://www.example.com/';

  CUSTOMERS = {
    1: {
      user: 'Alfred',
      gender: 'male',
      age: 24
    },
    2: {
      user: 'George',
      gender: 'male',
      age: 42
    },
    3: {
      user: 'Cynthia',
      gender: 'female',
      age: 28
    }
  };

  app = express();

  app.get('/', function(req, res) {
    return res.end('Hello World !');
  });

  app.get('/customers', function(req, res) {
    return res.json(CUSTOMERS);
  });

  app.get('/customers/:id', function(req, res) {
    return res.json(CUSTOMERS[parseInt(req.params.id)]);
  });

  describe('Routing', function() {
    var api;
    api = slumber.API(base_url, {});
    describe('#base_url', function() {
      return it('should retrieve a string with base_url of api', function() {
        return assert.equal(api.base_url, base_url);
      });
    });
    describe('one child', function() {
      return it('should retrieve a string with base_url of api with 1 child', function() {
        return assert.equal(api('customers').base_url, "" + base_url + "customers/");
      });
    });
    return describe('two children', function() {
      return it('should retrieve a string with base_url of api with 2 children', function() {
        return assert.equal(api('customers')(42).base_url, "" + base_url + "customers/42/");
      });
    });
  });

  describe('JsonSerializer', function() {
    var api;
    api = slumber.API(base_url, {});
    return describe('serializer', function() {
      it('should be an object', function() {
        return assert.equal('object', typeof api.serializer);
      });
      describe('#serializers', function() {
        return it('should return an array of available serializers', function() {
          return assert.equal('object', typeof api.serializer.serializers);
        });
      });
      return describe('#get_serializer()', function() {
        return it('should return the default serializer', function() {
          var serializer;
          serializer = api.serializer.get_serializer();
          assert.equal('object', typeof serializer);
          return assert.equal('json', serializer.key);
        });
      });
    });
  });

  describe('Local Express', function() {
    var api;
    api = null;
    before(function(done) {
      return freeport(function(err, port) {
        return app.listen(port, function() {
          return api = slumber.API("http://localhost:" + port + "/", {}, function() {
            return done();
          });
        });
      });
    });
    return describe('Connection', function() {
      it('should connect to express and return a string Hello World', function(done) {
        return api.get(function(err, ret) {
          assert.equal(err, null);
          assert.equal(ret, 'Hello World !');
          return done();
        });
      });
      it('should return a list of customers', function(done) {
        return api('customers').get(function(err, ret) {
          assert.equal(err, null);
          assert.equal('object', typeof ret);
          assert.equal(ret[1].user, CUSTOMERS[1].user);
          return done();
        });
      });
      return it('should return customer with id = 1', function(done) {
        return api('customers')(1).get(function(err, ret) {
          assert.equal(ret.user, CUSTOMERS[1].user);
          assert.equal(ret.age, CUSTOMERS[1].age);
          assert.equal(ret.gender, CUSTOMERS[1].gender);
          return done();
        });
      });
    });
  });

}).call(this);
